<div class="top-container">
  <div class="container">
    <div class="title-container">
      <h1 class="title-container__title"><span class="text-muted">Crown Land File: #{{application.cl_file}} &nbsp;&rsaquo;&nbsp;</span> {{application._id === '0' ? 'Create' : 'Edit Decision'}}</h1>
      <div class="title-container__actions">
        <!--
        <button class="btn btn-light" type="button" title="Cancel changes and return to previous page" 
          [routerLink]="application._id === '0' ? ['../'] : ['/search']">
          Cancel
        </button>
        -->
        <button class="btn btn-light" type="button"  (click)="cancelChanges()">
          Cancel
        </button>
        <button class="btn btn-primary" type="button" title="Save Decision"
          *ngIf="application._id !== '0'" 
          (click)="saveDecision()">
          Save
        </button>
        <!--
        <button class="btn btn-primary" type="button" title="Publish application"
          *ngIf="application._id !== '0' && !application.isPublished"
          (click)="publishApplication()">
          Publish
        </button>
        <button class="btn btn-danger" type="button" title="Un-publish application"
          *ngIf="application._id !== '0' && application.isPublished"
          (click)="unPublishApplication()">
          Unpublish
        </button>
        -->
        <!--
        <button class="btn btn-danger" type="button" title="Delete application"
          *ngIf="application._id !== '0' && !application.isPublished"
          (click)="deleteApplication()">
          Delete
        </button>
        -->
      </div>
      
      <!--
      <div class="title-container__actions">
        <button type="button" class="btn btn-light slide-l-btn" [routerLink]="['/a', application._id]" [disabled]="application._id === '0'">
          <i class="material-icons">info_outline</i>
          <span>Application Details</span>
        </button>
      </div>
      -->
      
    </div>
  </div>
</div>

<div class="bottom-container">
  <div class="container">
    <form class="mb-3" #decisionForm="ngForm">
      <fieldset>
        <legend>Decision Details</legend>
        <div class="form-group">
          <label>Description</label>
          <textarea class="form-control" rows="3" name="decisionDesc" id="decisionDesc" #decisionDesc="ngModel"
            [(ngModel)]="application.decision.description">
          </textarea>
        </div>
        <div class="form-group mb-0">
          <label>Decision Documents</label>
          <ul class="doc-list mb-3" *ngIf="application.decision.documents.length > 0">
            <li *ngFor="let file of application.decision.documents">
              <span class="cell icon">
                <i class="material-icons" (click)="api.downloadDocument(file)">insert_drive_file</i>
              </span>
              <span class="cell name" [title]="file.displayName || ''">
                <span class="cell__txt-content">
                  <a (click)="api.downloadDocument(file)">{{file.documentFileName}}</a>
                </span>
              </span>
              <!--
              <span class="cell publish-actions">
                <span class="btn-group">
                  <button class="btn btn-sm" [ngClass]="file.isPublished ? 'btn-success':'btn-light'" type="button" title="Publish this document"
                    (click)="publishDocument(file, application.decision.documents)">
                    Published
                  </button>
                  <button class="btn btn-sm" [ngClass]="!file.isPublished ? 'btn-dark active':'btn-light'" type="button" title="Unpublish this document"
                    (click)="unPublishDocument(file, application.decision.documents)">
                    Unpublished
                  </button>
                </span>
              </span>   
              -->      
              <span class="cell actions">
                <!--
                <button type="button" class="btn btn-light btn-sm" (click)="api.downloadDocument(file)" title="Download this document">
                  <i class="material-icons">file_download</i>
                </button>
                <button type="button" class="btn btn-light btn-sm" (click)="api.openDocument(file)" title="Open this document" [hidden]="api.isMS">
                  <i class="material-icons">open_in_new</i>
                </button>
                -->
                <span placement="top" title="{{file.isPublished ? 'Documents must be unpublished before they can be deleted':'Remove this document'}}">
                  <button type="button" class="btn btn-light btn-sm" [disabled]="file.isPublished" (click)="deleteDocument(file, application.decision.documents)">
                    <i class="material-icons">close</i>
                  </button>
                </span>
              </span>
            </li>
          </ul>
          <div class="file-upload">
            <input type="file" name="fileInput2" size="5000000" (change)="uploadFiles($event.target.files, application.decision.documents)" multiple>
            <div class="file-upload__target">
              <span class="file-upload__prompt">
                <i class="file-upload__prompt-icon material-icons">file_upload</i>
                <span class="file-upload__prompt-msg">Drop files to attach, or <em>browse</em>.</span>
              </span>
            </div>
          </div>
        </div>
      </fieldset>
    </form>
  </div>
</div>

<form class="mt-3" style="display: none;">
  <section class="card bg-light">
    <h3 for="decisionDesc">Decision</h3>

    <section *ngIf="!application.decision">
      <button type="button" class="btn btn-success" (click)="addDecision()" title="Add decision" [disabled]="application._id === '0'">
        <i class="material-icons">add</i>
        <span>Add Decision</span>
      </button>
    </section>

    <div *ngIf="application.decision">
      <section>
        <label class="h4 control-label mb-2" for="decisionDesc">Description <em>(Required)</em></label>
        <textarea class="form-control app-decision-desc" [ngClass]="{'is-invalid': decisionDesc.invalid}" type="text" id="decisionDesc"
          name="decisionDesc" rows="5" #decisionDesc="ngModel" [(ngModel)]="application.decision.description" required
          aria-required="true">
          </textarea>
        <div class="invalid-feedback">Description is required</div>
      </section>

      <!-- DECISION DOCUMENTS -->

      <!-- DECISION FORM BUTTONS -->
      <div class="section-form-btns mt-4">
        <!-- to save, decision form must be valid -->
        <button type="button" class="btn btn-success" (click)="saveDecision()" [disabled]="decisionForm.form.invalid" title="Save decision">
          <i class="material-icons">save</i>
          <span>Save</span>
        </button>
        <!-- to publish, decision form must be valid -->
        <button type="button" class="btn btn-primary" *ngIf="!application.decision.isPublished" (click)="publishDecision()"
          [disabled]="decisionForm.form.invalid" title="Publish decision">
          <i class="material-icons">play_arrow</i>
          <span>Publish</span>
        </button>
        <button type="button" class="btn btn-danger" *ngIf="application.decision.isPublished" (click)="unPublishDecision()"
          title="Unpublish decision">
          <i class="material-icons">pause</i>
          <span>Unpublish</span>
        </button>
        <!-- to delete, there must be no decision documents -->
        <button type="button" class="btn btn-danger" *ngIf="!application.decision.isPublished" (click)="deleteDecision()"
          [disabled]="application.decision.documents?.length > 0" title="Delete decision">
          <i class="material-icons">delete</i>
          <span>Delete</span>
        </button>
      </div>
    </div>
  </section>
</form>