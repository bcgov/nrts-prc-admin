<div class="spinner-container full-screen" *ngIf="loading" [@visibility]>
  <div class="spinner-new rotating"></div>
</div>

<ngb-alert type="danger" [dismissible]="false" *ngFor="let alert of alerts">{{alert}}</ngb-alert>

<div class="comment-periods">
  <div class="container" *ngIf="application">
    <div class="title-container mb-4">
      <h1>Manage Comment Periods</h1>
    </div>

    <div class="header-row row">
      <main class="col-md-8">
        <!-- HEADER -->
        <section class="card bg-dark">
          <h2 class="mb-0">{{application.client || '-'}}</h2>
          <div>{{application.purpose || '-'}} / {{application.subpurpose || '-'}}</div>
          <ul class="comment-periods__list">
            <li>CL File: {{application.cl_file || '-'}}</li>
            <li>Disp ID: {{application.tantalisID || '-'}}</li>
          </ul>
        </section>
      </main>

      <nav class="col-md-4">
        <section class="d-flex flex-column">
          <a class="btn btn-light slide-l-btn p-1 my-1" [routerLink]="['/a', application._id]">
            <i class="material-icons">info_outline</i>
            <span>Application Details</span>
          </a>
          <a class="btn btn-light slide-l-btn p-1 my-1" [routerLink]="['/comments', application._id]">
            <i class="material-icons">message</i>
            <span>Review Comments</span>
          </a>
          <button class="btn btn-light slide-l-btn p-1 my-1" (click)="openCommentPeriod(null, application._id)" [disabled]="commentPeriods.length > 0">
            <i class="material-icons">add</i>
            <span>Add Comment Period</span>
          </button>
        </section>
      </nav>
    </div>
  </div>

  <div class="comment-periods-body container" id="anchor-point">
    <p *ngIf="commentPeriods.length === 0">
      <em>This application has no comment periods.</em>
    </p>

    <table class="table comment-periods-table">
      <tbody class="comment-periods-table__content">
        <tr *ngFor="let item of commentPeriods">
          <td class="comment-periods-table__item">
            <!-- <h4>Comment Period</h4> -->
            <h5>{{(item.startDate | date) || 'start'}} to {{(item.endDate | date) || 'end'}}</h5>
            <ul class="nv-list comment-periods-table__item--list">
              <li class="p-0">
                <span class="name">Status:</span>
                <span class="value">{{getStatus(item)}}</span>
              </li>
              <!-- <li class="p-0">
              <span class="name"># Comments:</span>
              <span class="value">-</span>
            </li> -->
            </ul>
            <div class="comment-periods-table__item--buttons">
              <button class="btn btn-primary" (click)="openCommentPeriod(item, application._id)" title="Edit this comment period">
                <i class="material-icons">mode_edit</i>
                <span>Edit</span>
              </button>
              <button *ngIf="!item.isPublished" class="btn btn-danger" (click)="deleteCommentPeriod(item)" title="Delete this comment period">
                <i class="material-icons">delete</i>
                <span>Delete</span>
              </button>
              <button *ngIf="!item.isPublished" class="btn btn-success" (click)="publishCommentPeriod(item)" title="Publish this comment period">
                <i class="material-icons">play_arrow</i>
                <span>Publish</span>
              </button>
              <button *ngIf="item.isPublished" class="btn btn-dark" (click)="unPublishCommentPeriod(item)" title="Un-publish this comment period">
                <i class="material-icons">pause</i>
                <span>Un-Publish</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>